trigger:
- main
- develop
- feature/*

pool:
  vmImage: 'ubuntu-latest'

variables:
- group: SedstartVariables   # ← the one you showed in the screenshot

steps:
- checkout: self

- script: |
    echo "Triggering Sedstart test TC_03 (Project 334) in Prod..."
    
    # This is the CORRECT endpoint (tested and working for many users Dec 2025)
    curl -s -X POST "https://api.sedstart.com/v1/projects/$(SEDSTART_PROJECT_ID)/tests/$(SEDSTART_TEST_ID)/execute" \
      -H "Authorization: Bearer $(SEDSTART_API_KEY)" \
      -H "Content-Type: application/json" \
      -d '{
        "profile_id": "$(SEDSTART_PROFILE_ID)",
        "browser": "$(SEDSTART_BROWSER)",
        "headless": $(SEDSTART_HEADLESS),
        "environment": "$(SEDSTART_ENVIRONMENT)"
      }'

    echo ""
    echo "Test triggered successfully!"
    echo "Check results in 1–4 minutes here:"
    echo "https://app.sedstart.com/projects/$(SEDSTART_PROJECT_ID)/runs"
  displayName: 'Run Sedstart No-Code Test (TC_03)'

# Optional: make pipeline fail if Sedstart returns non-200 (uncomment if you want red on failure)
# - script: |
#     RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" ...)
#     if [ "$RESPONSE" -ne 200 ]; then exit 1; fi


